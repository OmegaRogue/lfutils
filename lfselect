#!/bin/bash
# read filenames from stdin/args and select them in lf.

while getopts i: opt; do
    case $opt in
        i) export id="$OPTARG" ;;
        ?) exit 1 ;;
    esac
done
shift $((OPTIND-1))
[ -z "$id" ] && echo id of lf is not given. >&2 && exit 1

[ -n "$1" ] && list="$1" || list="$(cat)"
list="$(printf '%s\n' "$list" | sed 's/"/\\"/g')"

# if only one file is given, put the cursor on it, don't select.
if [ "$(printf '%s\n' "$list" | wc -l)" -eq 1 ]; then
    lf -remote "send $id select \"$list\""
    exit
fi

cmd=
count=0

# build command line to select files and send to lf,
# 10 files at a time (selecting them one at a time is much slower).
# however, sending more than 10 files at a time might crash lf.
while IFS= read -r file; do
    ((count++))
    cmd="${cmd}select<space>\"$file\";toggle;"
    if [ $count -gt 10 ]; then
        lf -remote "send $id push :$cmd<enter>"
        count=0
        cmd=
    fi
done <<< "$(printf "%s\n" "$list" | sed 's/ /<space>/g')"
[ -n "$cmd" ] && lf -remote "send $id push :$cmd<enter>"
